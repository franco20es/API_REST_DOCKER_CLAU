{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState } from 'react';\nimport axios from 'axios';\nconst BACKEND_URL = 'http://localhost:8080/api/empresas';\nexport const useEmpresas = () => {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n\n  // Buscar empresa por RUC (SUNAT)\n  const buscarEmpresaPorRUC = async ruc => {\n    if (!ruc || ruc.length !== 11) {\n      throw new Error('RUC debe tener 11 dígitos');\n    }\n    setLoading(true);\n    setError(null);\n    try {\n      const token = 'cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjhmMTkzNTcyZGZhMTIyNjA3ZTgzZTk5';\n      const url = `https://api.perudevs.com/api/v1/ruc?document=${ruc}&key=${token}`;\n      const response = await axios.get(url, {\n        timeout: 10000\n      });\n      const data = response.data;\n      setLoading(false);\n      if (data && data.estado && data.mensaje === \"Encontrado\" && data.resultado) {\n        const resultado = data.resultado;\n        return {\n          ruc: resultado.oficio || ruc,\n          razonSocial: resultado.razon_social || resultado.nombre_comercial || 'No disponible',\n          direccion: resultado.direccion || '-',\n          estado: resultado.estado || 'ACTIVO',\n          condicion: resultado.condicion || 'HABIDO',\n          tipo: resultado.tipo || '-',\n          nombreComercial: resultado.nombre_comercial || '-',\n          fechaInscripcion: resultado.fecha_inscripcion || '-',\n          sistemaEmision: resultado.sistema_emision || '-',\n          actividadExterior: resultado.actividad_exterior || '-',\n          sistemaContabilidad: resultado.sistema_contabilidad || '-',\n          fechaEmisionElectronica: resultado.fecha_emision_electronica || '-',\n          fechaPle: resultado.fecha_ple || '-',\n          actividadesEconomicas: resultado.actividades_economicas || [],\n          departamento: '-',\n          provincia: '-',\n          distrito: '-',\n          ubigeo: '-'\n        };\n      } else {\n        setError('No se encontraron datos de la empresa en SUNAT');\n        return null;\n      }\n    } catch (err) {\n      setLoading(false);\n      if (err.code === 'ECONNABORTED') {\n        setError('Tiempo de espera agotado. Verifique su conexión a internet');\n      } else if (err.response) {\n        var _err$response$data;\n        setError(`Error del servidor: ${err.response.status} - ${((_err$response$data = err.response.data) === null || _err$response$data === void 0 ? void 0 : _err$response$data.mensaje) || 'Error desconocido'}`);\n      } else if (err.request) {\n        setError('No se pudo conectar con el servidor. Verifique su conexión a internet');\n      } else {\n        setError(`Error: ${err.message}`);\n      }\n      return null;\n    }\n  };\n\n  // ← GUARDAR empresa en el backend\n  const guardarEmpresaEnBackend = async empresaData => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await axios.post(BACKEND_URL, {\n        ruc: empresaData.ruc,\n        razon_social: empresaData.razonSocial,\n        direccion: empresaData.direccion,\n        estado: empresaData.estado,\n        condicion: empresaData.condicion,\n        departamento: empresaData.departamento || '-',\n        provincia: empresaData.provincia || '-',\n        distrito: empresaData.distrito || '-',\n        ubigeo: empresaData.ubigeo || '-'\n      });\n      setLoading(false);\n      return response.data;\n    } catch (err) {\n      var _err$response;\n      setLoading(false);\n      if (((_err$response = err.response) === null || _err$response === void 0 ? void 0 : _err$response.status) === 409) {\n        // Empresa ya existe - retornar la empresa existente\n        setError('Esta empresa ya está registrada');\n        return err.response.data;\n      }\n      setError('Error al guardar empresa en la base de datos');\n      console.error('Error guardando empresa:', err);\n      throw err;\n    }\n  };\n\n  // ← BUSCAR empresa en backend por RUC\n  const buscarEmpresaEnBackend = async ruc => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await axios.get(`${BACKEND_URL}/buscar/ruc/${ruc}`);\n      setLoading(false);\n      return response.data; // Retorna array de empresas\n    } catch (err) {\n      setLoading(false);\n      return null; // No es error si no se encuentra\n    }\n  };\n\n  // ← OBTENER todas las empresas registradas\n  const obtenerEmpresasRegistradas = async () => {\n    setLoading(true);\n    setError(null);\n    try {\n      const response = await axios.get(BACKEND_URL);\n      setLoading(false);\n      return response.data;\n    } catch (err) {\n      setLoading(false);\n      setError('Error al obtener empresas');\n      console.error('Error obteniendo empresas:', err);\n      throw err;\n    }\n  };\n\n  // ← ELIMINAR empresa\n  const eliminarEmpresa = async id => {\n    setLoading(true);\n    setError(null);\n    try {\n      await axios.delete(`${BACKEND_URL}/${id}`);\n      setLoading(false);\n      return true;\n    } catch (err) {\n      setLoading(false);\n      setError('Error al eliminar empresa');\n      console.error('Error eliminando empresa:', err);\n      throw err;\n    }\n  };\n  return {\n    loading,\n    error,\n    buscarEmpresaPorRUC,\n    // Consulta SUNAT\n    guardarEmpresaEnBackend,\n    // Guarda en PostgreSQL\n    buscarEmpresaEnBackend,\n    // Busca en PostgreSQL\n    obtenerEmpresasRegistradas,\n    // Lista todas de PostgreSQL\n    eliminarEmpresa // Elimina de PostgreSQL\n  };\n};\n_s(useEmpresas, \"Iz3ozxQ+abMaAIcGIvU8cKUcBeo=\");","map":{"version":3,"names":["useState","axios","BACKEND_URL","useEmpresas","_s","loading","setLoading","error","setError","buscarEmpresaPorRUC","ruc","length","Error","token","url","response","get","timeout","data","estado","mensaje","resultado","oficio","razonSocial","razon_social","nombre_comercial","direccion","condicion","tipo","nombreComercial","fechaInscripcion","fecha_inscripcion","sistemaEmision","sistema_emision","actividadExterior","actividad_exterior","sistemaContabilidad","sistema_contabilidad","fechaEmisionElectronica","fecha_emision_electronica","fechaPle","fecha_ple","actividadesEconomicas","actividades_economicas","departamento","provincia","distrito","ubigeo","err","code","_err$response$data","status","request","message","guardarEmpresaEnBackend","empresaData","post","_err$response","console","buscarEmpresaEnBackend","obtenerEmpresasRegistradas","eliminarEmpresa","id","delete"],"sources":["C:/Users/user/Desktop/PROYECTO-DE-JS-PARCTICA-3/sistema-facturacion/src/hooks/useEmpresas.js"],"sourcesContent":["import { useState } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst BACKEND_URL = 'http://localhost:8080/api/empresas';\r\n\r\nexport const useEmpresas = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n\r\n  // Buscar empresa por RUC (SUNAT)\r\n  const buscarEmpresaPorRUC = async (ruc) => {\r\n    if (!ruc || ruc.length !== 11) {\r\n      throw new Error('RUC debe tener 11 dígitos');\r\n    }\r\n\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const token = 'cGVydWRldnMucHJvZHVjdGlvbi5maXRjb2RlcnMuNjhmMTkzNTcyZGZhMTIyNjA3ZTgzZTk5';\r\n      const url = `https://api.perudevs.com/api/v1/ruc?document=${ruc}&key=${token}`;\r\n      \r\n      const response = await axios.get(url, {\r\n        timeout: 10000\r\n      });\r\n      \r\n      const data = response.data;\r\n      \r\n      setLoading(false);\r\n      \r\n      if (data && data.estado && data.mensaje === \"Encontrado\" && data.resultado) {\r\n        const resultado = data.resultado;\r\n        \r\n        return {\r\n          ruc: resultado.oficio || ruc,\r\n          razonSocial: resultado.razon_social || resultado.nombre_comercial || 'No disponible',\r\n          direccion: resultado.direccion || '-',\r\n          estado: resultado.estado || 'ACTIVO',\r\n          condicion: resultado.condicion || 'HABIDO',\r\n          tipo: resultado.tipo || '-',\r\n          nombreComercial: resultado.nombre_comercial || '-',\r\n          fechaInscripcion: resultado.fecha_inscripcion || '-',\r\n          sistemaEmision: resultado.sistema_emision || '-',\r\n          actividadExterior: resultado.actividad_exterior || '-',\r\n          sistemaContabilidad: resultado.sistema_contabilidad || '-',\r\n          fechaEmisionElectronica: resultado.fecha_emision_electronica || '-',\r\n          fechaPle: resultado.fecha_ple || '-',\r\n          actividadesEconomicas: resultado.actividades_economicas || [],\r\n          departamento: '-',\r\n          provincia: '-',\r\n          distrito: '-',\r\n          ubigeo: '-'\r\n        };\r\n      } else {\r\n        setError('No se encontraron datos de la empresa en SUNAT');\r\n        return null;\r\n      }\r\n    } catch (err) {\r\n      setLoading(false);\r\n      \r\n      if (err.code === 'ECONNABORTED') {\r\n        setError('Tiempo de espera agotado. Verifique su conexión a internet');\r\n      } else if (err.response) {\r\n        setError(`Error del servidor: ${err.response.status} - ${err.response.data?.mensaje || 'Error desconocido'}`);\r\n      } else if (err.request) {\r\n        setError('No se pudo conectar con el servidor. Verifique su conexión a internet');\r\n      } else {\r\n        setError(`Error: ${err.message}`);\r\n      }\r\n      \r\n      return null;\r\n    }\r\n  };\r\n\r\n  // ← GUARDAR empresa en el backend\r\n  const guardarEmpresaEnBackend = async (empresaData) => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await axios.post(BACKEND_URL, {\r\n        ruc: empresaData.ruc,\r\n        razon_social: empresaData.razonSocial,\r\n        direccion: empresaData.direccion,\r\n        estado: empresaData.estado,\r\n        condicion: empresaData.condicion,\r\n        departamento: empresaData.departamento || '-',\r\n        provincia: empresaData.provincia || '-',\r\n        distrito: empresaData.distrito || '-',\r\n        ubigeo: empresaData.ubigeo || '-'\r\n      });\r\n      \r\n      setLoading(false);\r\n      return response.data;\r\n    } catch (err) {\r\n      setLoading(false);\r\n      \r\n      if (err.response?.status === 409) {\r\n        // Empresa ya existe - retornar la empresa existente\r\n        setError('Esta empresa ya está registrada');\r\n        return err.response.data;\r\n      }\r\n      \r\n      setError('Error al guardar empresa en la base de datos');\r\n      console.error('Error guardando empresa:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // ← BUSCAR empresa en backend por RUC\r\n  const buscarEmpresaEnBackend = async (ruc) => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await axios.get(`${BACKEND_URL}/buscar/ruc/${ruc}`);\r\n      setLoading(false);\r\n      return response.data; // Retorna array de empresas\r\n    } catch (err) {\r\n      setLoading(false);\r\n      return null; // No es error si no se encuentra\r\n    }\r\n  };\r\n\r\n  // ← OBTENER todas las empresas registradas\r\n  const obtenerEmpresasRegistradas = async () => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      const response = await axios.get(BACKEND_URL);\r\n      setLoading(false);\r\n      return response.data;\r\n    } catch (err) {\r\n      setLoading(false);\r\n      setError('Error al obtener empresas');\r\n      console.error('Error obteniendo empresas:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  // ← ELIMINAR empresa\r\n  const eliminarEmpresa = async (id) => {\r\n    setLoading(true);\r\n    setError(null);\r\n\r\n    try {\r\n      await axios.delete(`${BACKEND_URL}/${id}`);\r\n      setLoading(false);\r\n      return true;\r\n    } catch (err) {\r\n      setLoading(false);\r\n      setError('Error al eliminar empresa');\r\n      console.error('Error eliminando empresa:', err);\r\n      throw err;\r\n    }\r\n  };\r\n\r\n  return {\r\n    loading,\r\n    error,\r\n    buscarEmpresaPorRUC,              // Consulta SUNAT\r\n    guardarEmpresaEnBackend,          // Guarda en PostgreSQL\r\n    buscarEmpresaEnBackend,           // Busca en PostgreSQL\r\n    obtenerEmpresasRegistradas,       // Lista todas de PostgreSQL\r\n    eliminarEmpresa                   // Elimina de PostgreSQL\r\n  };\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}